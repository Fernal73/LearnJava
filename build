#! /usr/bin/env bash

#######################################################################
#@author: Linus Fernandes(linusfernandes @gmail.com)
# @file: build
## @created: Friday May 03, 2019 21: 20: 25 IST
# @copyright: Copyright(c) Linus Fernandes
## @description: 
######################################################################
usage() {
        echo "usage: build dir"
        exit 1
}
createDex()
{
  rm -rf $proj/dist
  type dx &>/dev/null && dx --dex --output=$proj.dex $proj && mkdir $proj/dist && cp $proj.dex $proj/dist && exit 0
}


createJar()
{
  cd $proj
  type jar &>/dev/null && jar cfnm $proj.jar manifest.mf `find . -name "*.class" ! -path "*.git*" ! -type d` 
  [ -e $proj.jar ] && cp $proj.jar .. && mkdir -p dist && mv $proj.jar dist
  cd ..
  exit 0
}
proj=$1
ver=""
if [ -z $proj ]
  then
    usage
else
    echo $proj
    ver=$(<$proj/.ver)
    ecj -$ver $proj
    success=$?
    if [ $success -eq 0 ]
      then
      createDex
      createJar
    fi
fi
exit $success
