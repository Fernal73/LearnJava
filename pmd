#!/bin/bash
usage()
{
  echo "Usage: $0 dir"
  echo "dir - Project directory"
  exit 1
}
if [ "$#" -ne 1 ] || ! [ -d "$1" ]; 
then
  usage
fi
declare -r rulesFile="pmdrules.xml"
declare -r cacheFile="pmd.cache"
declare -r errFile="pmd.errors"
declare -r format="text"
declare -i threads=5
declare -i minpriority=5
declare -r classpathFile="pmd.cp"
declare -r mainClass="net.sourceforge.pmd.PMD"

java -cp @"$classpathFile" \
"$mainClass" \
-d "$1" -R "$rulesFile" -f "$format" \
-min "$minpriority" -norulesetcompatibility \
-failOnViolation true -cache "$1"/"$cacheFile" \
-reportfile "$1"/"$errFile" \
-auxclasspath "$1" \
-t "$threads" \
|| { exitCode="$?";echo "$0 exited with error code $exitCode"; exit "$exitCode";}
res=$?
exit $res
