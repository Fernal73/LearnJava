#!/bin/bash
usage()
{
  echo "Usage: $0 dir rulesfile"
  echo "dir - Project directory"
  echo "rulesfile - Rules file"
  exit 1
}
if [ "$#" -lt 1 ] || ! [ -d "$1" ]; 
then
  usage
fi

rules_file="google_checks.xml"
properties_file="checkstyle.properties"
output_file="cs.errors"
jarFile="lib/checkstyle-8.20-all.jar"

if [ ! -z $2 ]
  then
    rules_file=$2
fi
if [ ! -e $rules_file ]
  then
    echo "$rules_file cannot be found."
    usage
fi

if [ ! -e $properties_file ]
  then
    echo "$properties_file not found. Creating..."
    touch $properties_file || \
      echo "Unable to create $properties_file"
    echo "Create/Modify $properties_file to configure checkstyle"
fi
(cd $1 && \
java -jar \
../$jarFile \
-c ../$rules_file -d \
-p ../$properties_file \
-o $output_file \
`find . -type f -name "*.java" \
! -path "docs/**" ! -path "dist/**"`)
exit $?
